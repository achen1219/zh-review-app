// generate_data.js
// Usage: node generate_data.js
const fetch = require('node-fetch');
const fs    = require('fs');

// â† your real API key here
const apiKey = 'ca3c6b07-0e0e-4774-a57d-6d0bb178801d';

// 1) Your schedule: dates â†’ array of chars
const schedule = {
  "2025-05-07": ["è…°","è“‹","åˆ","å¤","çœ","æ¡","åŒ…","é¡","è³‡","å½±","æ•¦","çˆ¾","æ‚Ÿ","æ‹†"],
  "2025-05-08": ["å–","æŠ¬","è…°","è“‹","åˆ","å¤","æŠ€","ç¥¨","å‘¨","ä¾‹","æ“","æ“ ","ç››","éš¨"]
  // â€¦add new days here once a monthâ€¦
};
// flatten & dedupe
const chars = Array.from(new Set(Object.values(schedule).flat()));

async function fetchDetail(ch) {
  // correct v2 endpoint for Detail
  const url = `https://pedia.cloud.edu.tw/api/v2/Detail?term=${encodeURIComponent(ch)}&api_key=${apiKey}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const { data } = await res.json();
  return {
    bopomofo: data.bopomofo || '',
    definitions: data.definitions || [],
    examples: data.examples || [],
    phrases2: data.phrases_2 || [],
    phrases3: data.phrases_3 || [],
    phrases4: data.collocations_4 || []
  };
}

(async () => {
  const details = {};
  for (const ch of chars) {
    try {
      const d = await fetchDetail(ch);
      details[ch] = { char: ch, ...d };
      console.log(`âœ… ${ch}`);
    } catch (err) {
      console.warn(`âš ï¸  ${ch} failed: ${err.message}`);
      details[ch] = { char: ch, bopomofo:'', definitions:[], examples:[], phrases2:[], phrases3:[], phrases4:[] };
    }
  }

  // write data.js
  const out = [
    '// AUTO-GENERATED by generate_data.js',
    'export default ',
    JSON.stringify(details, null, 2),
    ';'
  ].join('\n');
  fs.writeFileSync('data.js', out, 'utf-8');
  console.log('ğŸ‰ data.js written with', Object.keys(details).length, 'entries');
})();
