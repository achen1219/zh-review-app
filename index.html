<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>每日複習</title>
  <style>
    /* 省略 CSS，同上 */
  </style>
</head>
<body>
  <h1>📅 每日複習</h1>
  <select id="date-selector"></select>
  <div id="flashcards"></div>

  <script src="schedule.js"></script>
  <script>
    const apiKey = 'ca3c6b07-0e0e-4774-a57d-6d0bb178801d';  // 您的 API key
    const dateSel = document.getElementById('date-selector');
    const flashDiv = document.getElementById('flashcards');

    // 1. 填日期下拉選單
    Object.keys(schedule).forEach(date => {
      const opt = document.createElement('option');
      opt.value = date; opt.textContent = date;
      dateSel.appendChild(opt);
    });

    dateSel.addEventListener('change', () => {
      const chars = schedule[dateSel.value];
      renderFlashcards(chars);
    });

    // 預設第一天
    dateSel.value = Object.keys(schedule)[0];
    renderFlashcards(schedule[dateSel.value]);

    // 2. 取 API 並產生卡片
    async function renderFlashcards(chars) {
      flashDiv.innerHTML = '<p>載入中…</p>';
      const details = await Promise.all(
        chars.map(ch => fetchCharDetail(ch))
      );
      flashDiv.innerHTML = '';
      details.forEach(d => {
        const card = document.createElement('div');
        card.className = 'flashcard';
        card.innerHTML = `
          <h2>${d.char}</h2>
          <button onclick="play('${d.char}')">🔊 發音</button>
          <p>注音：${d.bop}</p>
          <p>二字：${d.phrases2.join('、')}</p>
          <p>三字：${d.phrases3.join('、')}</p>
          <p>四字：${d.phrase4}</p>
          <p>定義：${d.def}</p>
          <p>例句：${d.example}</p>
        `;
        flashDiv.appendChild(card);
      });
    }

    // 3. 呼叫教育百科 API
    async function fetchCharDetail(ch) {
      const url = `https://pedia.cloud.edu.tw/api/v1/character/${encodeURIComponent(ch)}?api_key=${apiKey}`;
      const res = await fetch(url);
      const json = await res.json();
      // 以下依您拿到的 JSON 屬性調整
      return {
        char: ch,
        bop: json.pinyin_bopomofo || '',
        phrases2: json.phrases_2 || [],
        phrases3: json.phrases_3 || [],
        phrase4: json.collocations_4?.[0] || '',
        def: json.definitions?.[0] || '',
        example: json.examples?.[0] || ''
      };
    }

    // 4. 語音
    function play(ch) {
      const u = new SpeechSynthesisUtterance(ch);
      u.lang = 'zh-TW';
      speechSynthesis.speak(u);
    }
  </script>
</body>
</html>
