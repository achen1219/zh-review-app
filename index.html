<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ¯æ—¥è¤‡ç¿’</title>
  <style>
    /* çœç•¥ CSSï¼ŒåŒä¸Š */
  </style>
</head>
<body>
  <h1>ğŸ“… æ¯æ—¥è¤‡ç¿’</h1>
  <select id="date-selector"></select>
  <div id="flashcards"></div>

  <script src="schedule.js"></script>
  <script>
    const apiKey = 'ca3c6b07-0e0e-4774-a57d-6d0bb178801d';  // æ‚¨çš„ API key
    const dateSel = document.getElementById('date-selector');
    const flashDiv = document.getElementById('flashcards');

    // 1. å¡«æ—¥æœŸä¸‹æ‹‰é¸å–®
    Object.keys(schedule).forEach(date => {
      const opt = document.createElement('option');
      opt.value = date; opt.textContent = date;
      dateSel.appendChild(opt);
    });

    dateSel.addEventListener('change', () => {
      const chars = schedule[dateSel.value];
      renderFlashcards(chars);
    });

    // é è¨­ç¬¬ä¸€å¤©
    dateSel.value = Object.keys(schedule)[0];
    renderFlashcards(schedule[dateSel.value]);

    // 2. å– API ä¸¦ç”¢ç”Ÿå¡ç‰‡
    async function renderFlashcards(chars) {
      flashDiv.innerHTML = '<p>è¼‰å…¥ä¸­â€¦</p>';
      const details = await Promise.all(
        chars.map(ch => fetchCharDetail(ch))
      );
      flashDiv.innerHTML = '';
      details.forEach(d => {
        const card = document.createElement('div');
        card.className = 'flashcard';
        card.innerHTML = `
          <h2>${d.char}</h2>
          <button onclick="play('${d.char}')">ğŸ”Š ç™¼éŸ³</button>
          <p>æ³¨éŸ³ï¼š${d.bop}</p>
          <p>äºŒå­—ï¼š${d.phrases2.join('ã€')}</p>
          <p>ä¸‰å­—ï¼š${d.phrases3.join('ã€')}</p>
          <p>å››å­—ï¼š${d.phrase4}</p>
          <p>å®šç¾©ï¼š${d.def}</p>
          <p>ä¾‹å¥ï¼š${d.example}</p>
        `;
        flashDiv.appendChild(card);
      });
    }

    // 3. å‘¼å«æ•™è‚²ç™¾ç§‘ API
    async function fetchCharDetail(ch) {
      const url = `https://pedia.cloud.edu.tw/api/v1/character/${encodeURIComponent(ch)}?api_key=${apiKey}`;
      const res = await fetch(url);
      const json = await res.json();
      // ä»¥ä¸‹ä¾æ‚¨æ‹¿åˆ°çš„ JSON å±¬æ€§èª¿æ•´
      return {
        char: ch,
        bop: json.pinyin_bopomofo || '',
        phrases2: json.phrases_2 || [],
        phrases3: json.phrases_3 || [],
        phrase4: json.collocations_4?.[0] || '',
        def: json.definitions?.[0] || '',
        example: json.examples?.[0] || ''
      };
    }

    // 4. èªéŸ³
    function play(ch) {
      const u = new SpeechSynthesisUtterance(ch);
      u.lang = 'zh-TW';
      speechSynthesis.speak(u);
    }
  </script>
</body>
</html>
