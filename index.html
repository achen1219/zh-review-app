<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>每日複習</title>
  <style>
    body { font-family: 'Microsoft JhengHei', sans-serif; padding: 20px; }
    h1, h2 { color: #333; }
    .flashcard { border:1px solid #ccc; padding:10px; margin:10px 0; border-radius:5px; max-width:360px; }
    .char { display:inline-block; width:50px; font-size:24px; }
    select, button { font-size:16px; margin-top:8px; }
    #points { margin-top:15px; font-weight:bold; }
  </style>
</head>
<body>
  <h1>📅 每日複習</h1>

  <label for="date-selector">選擇日期：</label>
  <select id="date-selector"></select>

  <h2>🔖 生字卡片</h2>
  <div id="flashcards"></div>

  <h2>🎮 遊戲1：字義配對</h2>
  <div id="points">積分: 0</div>
  <div id="game1"></div>
  <button id="submitBtn" onclick="checkAnswers()">提交</button>
  <div id="result"></div>

  <!-- 載入排程 -->
  <script src="schedule.js"></script>
  <script>
    const dateSel = document.getElementById('date-selector');
    const flashDiv = document.getElementById('flashcards');
    const gameDiv  = document.getElementById('game1');
    const ptsDiv   = document.getElementById('points');
    const resDiv   = document.getElementById('result');
    const btn      = document.getElementById('submitBtn');

    // 填日期
    for (let d of Object.keys(schedule)) {
      let o = document.createElement('option');
      o.value = o.textContent = d;
      dateSel.appendChild(o);
    }
    dateSel.addEventListener('change', () => renderFor(dateSel.value));

    // 分數
    let points = Number(localStorage.getItem('zhReviewPoints')||0);
    function updatePts() { ptsDiv.textContent = '積分: ' + points; }
    function savePts()   { localStorage.setItem('zhReviewPoints', points); }

    // 產生當日內容
    function renderFor(date) {
      flashDiv.innerHTML = '';
      gameDiv.innerHTML  = '';
      resDiv.innerHTML   = '';
      btn.disabled = false;
      updatePts();

      let chars = schedule[date];
      // 生字卡片
      for (let ch of chars) {
        let c = document.createElement('div');
        c.className = 'flashcard';
        c.innerHTML = `<h2>${ch}</h2>
          <button onclick="play('${ch}')">🔊 發音</button>`;
        flashDiv.appendChild(c);
      }
      // 配對遊戲（重複用字本身當「假定義」示範）
      for (let ch of chars) {
        let row = document.createElement('div');
        row.innerHTML = `
          <span class="char">${ch}</span>
          <select data-answer="${ch}">
            <option value="">-- 選擇 字義 --</option>
            <option>${ch}</option>
            <option>錯誤選項</option>
          </select>`;
        gameDiv.appendChild(row);
      }
    }

    // 檢查答案
    function checkAnswers() {
      let sels = document.querySelectorAll('#game1 select');
      let ok = 0;
      sels.forEach(s=>{
        if (s.value===s.getAttribute('data-answer')) ok++;
        s.disabled = true;
      });
      let earn = ok * 5;
      points += earn; savePts(); updatePts();
      btn.disabled = true;
      resDiv.textContent = ok===sels.length
        ? `👏 全對！ +${earn} 分`
        : `❌ 答對 ${ok}/${sels.length} 題，+${earn} 分`;
    }

    // 發音
    function play(ch) {
      let u = new SpeechSynthesisUtterance(ch);
      u.lang = 'zh-TW';
      speechSynthesis.speak(u);
    }

    // 預設載入第一天
    dateSel.value = Object.keys(schedule)[0];
    renderFor(dateSel.value);
  </script>
</body>
</html>
