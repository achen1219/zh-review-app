<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ¯æ—¥è¤‡ç¿’</title>
  <style>
    body { font-family: 'Microsoft JhengHei', sans-serif; padding: 20px; }
    h1, h2 { color: #333; }
    .flashcard { border:1px solid #ccc; padding:10px; margin:10px 0; border-radius:5px; max-width:360px; }
    .char { display:inline-block; width:50px; font-size:24px; }
    select, button { font-size:16px; margin-top:8px; }
    #points { margin-top:15px; font-weight:bold; }
  </style>
</head>
<body>
  <h1>ğŸ“… æ¯æ—¥è¤‡ç¿’</h1>

  <label for="date-selector">é¸æ“‡æ—¥æœŸï¼š</label>
  <select id="date-selector"></select>

  <h2>ğŸ”– ç”Ÿå­—å¡ç‰‡</h2>
  <div id="flashcards"></div>

  <h2>ğŸ® éŠæˆ²1ï¼šå­—ç¾©é…å°</h2>
  <div id="points">ç©åˆ†: 0</div>
  <div id="game1"></div>
  <button id="submitBtn" onclick="checkAnswers()">æäº¤</button>
  <div id="result"></div>

  <!-- è¼‰å…¥æ’ç¨‹ -->
  <script src="schedule.js"></script>
  <script>
    const dateSel = document.getElementById('date-selector');
    const flashDiv = document.getElementById('flashcards');
    const gameDiv  = document.getElementById('game1');
    const ptsDiv   = document.getElementById('points');
    const resDiv   = document.getElementById('result');
    const btn      = document.getElementById('submitBtn');

    // å¡«æ—¥æœŸ
    for (let d of Object.keys(schedule)) {
      let o = document.createElement('option');
      o.value = o.textContent = d;
      dateSel.appendChild(o);
    }
    dateSel.addEventListener('change', () => renderFor(dateSel.value));

    // åˆ†æ•¸
    let points = Number(localStorage.getItem('zhReviewPoints')||0);
    function updatePts() { ptsDiv.textContent = 'ç©åˆ†: ' + points; }
    function savePts()   { localStorage.setItem('zhReviewPoints', points); }

    // ç”¢ç”Ÿç•¶æ—¥å…§å®¹
    function renderFor(date) {
      flashDiv.innerHTML = '';
      gameDiv.innerHTML  = '';
      resDiv.innerHTML   = '';
      btn.disabled = false;
      updatePts();

      let chars = schedule[date];
      // ç”Ÿå­—å¡ç‰‡
      for (let ch of chars) {
        let c = document.createElement('div');
        c.className = 'flashcard';
        c.innerHTML = `<h2>${ch}</h2>
          <button onclick="play('${ch}')">ğŸ”Š ç™¼éŸ³</button>`;
        flashDiv.appendChild(c);
      }
      // é…å°éŠæˆ²ï¼ˆé‡è¤‡ç”¨å­—æœ¬èº«ç•¶ã€Œå‡å®šç¾©ã€ç¤ºç¯„ï¼‰
      for (let ch of chars) {
        let row = document.createElement('div');
        row.innerHTML = `
          <span class="char">${ch}</span>
          <select data-answer="${ch}">
            <option value="">-- é¸æ“‡ å­—ç¾© --</option>
            <option>${ch}</option>
            <option>éŒ¯èª¤é¸é …</option>
          </select>`;
        gameDiv.appendChild(row);
      }
    }

    // æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswers() {
      let sels = document.querySelectorAll('#game1 select');
      let ok = 0;
      sels.forEach(s=>{
        if (s.value===s.getAttribute('data-answer')) ok++;
        s.disabled = true;
      });
      let earn = ok * 5;
      points += earn; savePts(); updatePts();
      btn.disabled = true;
      resDiv.textContent = ok===sels.length
        ? `ğŸ‘ å…¨å°ï¼ +${earn} åˆ†`
        : `âŒ ç­”å° ${ok}/${sels.length} é¡Œï¼Œ+${earn} åˆ†`;
    }

    // ç™¼éŸ³
    function play(ch) {
      let u = new SpeechSynthesisUtterance(ch);
      u.lang = 'zh-TW';
      speechSynthesis.speak(u);
    }

    // é è¨­è¼‰å…¥ç¬¬ä¸€å¤©
    dateSel.value = Object.keys(schedule)[0];
    renderFor(dateSel.value);
  </script>
</body>
</html>
